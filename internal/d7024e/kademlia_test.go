package d7024e

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestIn(t *testing.T) {
	con := NewContact(NewRandomKademliaID(), "localhost:8000")
	con2 := NewContact(NewRandomKademliaID(), "localhost:8001")
	con3 := NewContact(NewRandomKademliaID(), "localhost:8002")
	lst := []Contact{con, con2, con3}
	check := in(con3, lst)
	if !check {
		t.Errorf("CONTACT NOT IN LIST")
	}
	assert.True(t, check)
}

func TestLookupContact(t *testing.T) {
	rt := NewRoutingTable(NewContact(NewKademliaID("FFFFFFFF00000000000000000000000000000000"), "localhost"))
	con1 := NewContact(NewKademliaID("FFFFFFFF00000000000000000000000000000000"), "localhost")
	con2 := NewContact(NewKademliaID("1111111100000000000000000000000000000000"), "localhost")
	con3 := NewContact(NewKademliaID("1111111100000000000200000000000000000000"), "localhost")
	con4 := NewContact(NewKademliaID("1111111100000000000300000000000000000000"), "localhost")
	con5 := NewContact(NewKademliaID("1111111100000000000400000000000000000000"), "localhost")
	con6 := NewContact(NewKademliaID("1111111100000000000500000000000000000000"), "localhost")
	con7 := NewContact(NewKademliaID("1111111100000000000600000000000000000000"), "localhost")
	con8 := NewContact(NewKademliaID("1111111100000000000700000000000000000000"), "localhost")
	con10 := NewContact(NewKademliaID("1111111100000000000800000000000000000000"), "localhost")
	con11 := NewContact(NewKademliaID("1111111100000000000900000000000000000000"), "localhost")
	con12 := NewContact(NewKademliaID("1111111100000000001000000000000000000000"), "localhost")
	con13 := NewContact(NewKademliaID("1111111100000000001100000000000000000000"), "localhost")
	con14 := NewContact(NewKademliaID("1111111100000000001200000000000000000000"), "localhost")
	con15 := NewContact(NewKademliaID("1111111100000000001300000000000000000000"), "localhost")
	con16 := NewContact(NewKademliaID("1111111100000000001400000000000000000000"), "localhost")
	con17 := NewContact(NewKademliaID("1111111100000000001500000000000000000000"), "localhost")
	con18 := NewContact(NewKademliaID("11111111000000000016100000000000000000000"), "localhost")
	con19 := NewContact(NewKademliaID("1111111100000000001700000000000000000000"), "localhost")
	con20 := NewContact(NewKademliaID("1111111100000000001800000000000000000000"), "localhost")
	con21 := NewContact(NewKademliaID("1111111100000000001900000000000000000000"), "localhost")
	con22 := NewContact(NewKademliaID("1111111100000000002000000000000000000000"), "localhost")
	con23 := NewContact(NewKademliaID("1111111100000000002100000000000000000000"), "localhost")
	con24 := NewContact(NewKademliaID("1111111100000000002200000000000000000000"), "localhost")
	con25 := NewContact(NewKademliaID("1111111100000000002300000000000000000000"), "localhost")
	con26 := NewContact(NewKademliaID("1111111100000000002400000000000000000000"), "localhost")
	rt.AddContact(con1)
	rt.AddContact(con2)
	rt.AddContact(con3)
	rt.AddContact(con4)
	rt.AddContact(con5)
	rt.AddContact(con6)
	rt.AddContact(con7)
	rt.AddContact(con8)
	rt.AddContact(con10)
	rt.AddContact(con11)
	rt.AddContact(con12)
	rt.AddContact(con13)
	rt.AddContact(con14)
	rt.AddContact(con15)
	rt.AddContact(con16)
	rt.AddContact(con17)
	rt.AddContact(con18)
	rt.AddContact(con19)
	rt.AddContact(con20)
	rt.AddContact(con21)
	rt.AddContact(con22)
	rt.AddContact(con23)
	rt.AddContact(con24)
	rt.AddContact(con25)
	rt.AddContact(con26)
	network := NewNetwork(rt)
	go network.Listen()
	kademlia := Kademlia{network}
	// shortlist := kademlia.LookupContact(&con17)
	// assert.Equal(t, con17.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con18)
	// assert.Equal(t, con18.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con19)
	// assert.Equal(t, con19.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con20)
	// assert.Equal(t, con20.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con21)
	// assert.Equal(t, con21.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con22)
	// assert.Equal(t, con22.ID, shortlist[0].ID)
	shortlistJSON := kademlia.LookupContact(&con23)
	shortlist := network.KTriples(shortlistJSON)
	assert.Equal(t, con23.ID, shortlist[0].ID)
	// //shortlist = kademlia.LookupContact(&con24)
	// //assert.Equal(t, con24.ID, shortlist[0].ID)
	// //shortlist = kademlia.LootkupContact(&con25)
	// //assert.Equal(t, con25.ID, shortlist[0].ID)
	// //shortlist = kademlia.LookupContact(&con26)
	// //assert.Equal(t, con26.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con1)
	// assert.Equal(t, con1.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con2)
	// assert.Equal(t, con2.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con3)
	// assert.Equal(t, con3.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con4)
	// assert.Equal(t, con4.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con5)
	// assert.Equal(t, con5.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con6)
	// assert.Equal(t, con6.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con7)
	// assert.Equal(t, con7.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con8)
	// assert.Equal(t, con8.ID, shortlist[0].ID)
	// shortlist = kademlia.LookupContact(&con10)
	// assert.Equal(t, con10.ID, shortlist[0].ID)

}

// func TestLookupData(t *testing.T) {
// rt := NewRoutingTable(NewContact(NewKademliaID("FFFFFFFF00000000000000000000000000000000"), "localhost"))
// con1 := NewContact(NewKademliaID("FFFFFFFF00000000000000000000000000000000"), "localhost")
// con2 := NewContact(NewKademliaID("1111111100000000000000000000000000000000"), "localhost")
// con3 := NewContact(NewKademliaID("1111111100000000000200000000000000000000"), "localhost")
// con4 := NewContact(NewKademliaID("1111111100000000000300000000000000000000"), "localhost")
// con5 := NewContact(NewKademliaID("1111111100000000000400000000000000000000"), "localhost")
// con6 := NewContact(NewKademliaID("1111111100000000000500000000000000000000"), "localhost")
// con7 := NewContact(NewKademliaID("1111111100000000000600000000000000000000"), "localhost")
// rt.AddContact(con1)
// rt.AddContact(con2)
// rt.AddContact(con3)
// rt.AddContact(con4)
// rt.AddContact(con5)
// rt.AddContact(con6)
// rt.AddContact(con7)
// network := NewNetwork(rt)
// kademlia := Kademlia{network}
// shortlist := kademlia.LookupData(&con2)
// fmt.Println(shortlist)
// assert.Equal(t, con2.ID, shortlist[0].ID)
//
// }
//
